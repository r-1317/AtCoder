# AHC040

## 最初の方針
- 長辺を横にして一列に並べる
- それを複数段重ねる
### どのように分けるか
- 正方形に近いほど高得点
- 標準偏差分だけ余裕を見る
  - バッファは調整
- 幅の合計が均等になるように分けたい
  - ひとまず個数で均等に分ける

## 01の方針
- 10個横並び
- 横並び個数は変化させることにする
- 最低でもN/2回の挑戦回数がある
  - N層から2層の積み上げまで試せる

## 01提出
- 提出前の相対スコア: 0(未提出)
- 提出前順位: 189位(未提出)
- 絶対スコア: 61130410
- 相対スコア: 46,824,457,188
- 順位: 22位
- 割と良いのでは
- (おそらく)全く同じことをしている人が他に2人いる
- サンプルケース0000の27番の向きが縦長になっているように見える
- 毎回の測定誤差を利用したい
  - 良かった回を何度も回す

## 02の方針
- 最も良かった回を何度も回す
  - 上位複数個でも良さそう
  - 複数個にする
  - 個数は調整
- 1列に並べる個数は20もあれば十分だろう

## 02提出
- 提出前の相対スコア: 46,818,160,783
- 提出前順位: 23位
- 絶対スコア: 61130410
- 相対スコア: 46,818,160,783
- 順位: 23位

## 02を踏まえて
- 一切変わらない
- 問題をよく読んだら、全く意味がないことがわかった。
- 余った実行回数を活用する方法を考えたい。

## 03の方針
- 測定誤差により、長辺と短辺が逆になっていることがある。
  - 確率で向きを変えるようにする
  - 2辺の差(dとおく)がs以下なら(s-d)/(2s)の確率で向きを変える
- 毎回N列から始める必要もない
  - 3または4列から始める
  - Nの数に応じて変えてもいいかも
  - 4からN/まで
- それをtが尽きるまで繰り返す

## 03提出
- 提出前の相対スコア: 45,434,848,122
- 提出前順位: 84位
- 絶対スコア: 61019527
- 相対スコア: 45,532,676,551
- 順位: 83位

## 03を踏まえて
- 絶対スコアが僅かに上がった
- 無駄な操作回数が多い気がする
- N/4までだとNが大きい場合に無駄が多い
  - √N+5とか
- max(4, √N-5)とmin(N/4, √N+3)とか
  - 定数部分の数に根拠はない
### 確率について
- d<sでなくても変えるべきではないか
- シグモイド関数に従った確率ではどうか
  - 辺1と辺2の差をsか何かで割ったもの

## 04の方針
### 一列の個数
- max(4, √N-5)とmin(N/4, √N+3)の間を繰り返す
### 確率
- sigmoid(縦幅-横幅*a)の確率で回転
  - aは定数であり、調整する
  - ひとまずaにsを代入

## 04提出 (a=1/s)
- 提出前の相対スコア: 45,514,106,568
- 提出前順位: 128位
- 絶対スコア: 60457122
- 相対スコア: 45,932,485,819
- 順位: 120位
- ジャッジがなかなか始まらない
  - 始まった

## 04を踏まえて
- スコアが上がった
- 最適な定数aを探るべきか
- もっと抜本的な改良が必要かも
  - ひとまずaにを代入
- a=1/2sで試す

## 04提出 (a=1/2s)
- 提出前の相対スコア: 45,932,485,819
- 提出前順位: 119位
- 絶対スコア: 60243497
- 相対スコア: 46,084,363,739
- 順位: 116位

## 04を踏まえて(2回目)
- スコアが少し上がった
- 最適な定数aを探る必要がある
- h, w, sから確率を求める関数はあると思う
  - 求めるのは難しそう
- a=1/3sで試す

## 04提出 (a=1/3s)
- 提出前の相対スコア: 45,973,709,195
- 提出前順位: 125位
- 絶対スコア: 60165798
- 相対スコア: 46,039,250,149 
- 順位: 124位

## 04を踏まえて(3回目)
- スコアが僅かに上がった
  - 誤差な気もする
- a=1/4sも試す

## 04提出 (a=1/4s)
- 提出前の相対スコア: 46,071,147,980
- 提出前順位: 126位
- 絶対スコア: 60120903
- 相対スコア: 46,121,293,949
- 順位: 120位

## 04を踏まえて(4回目)
- また僅かに上がった
- 下がるまで続ける
- 次はa=1/5s
- ビジュアライザを見ると、細長い長方形の回転のほうが意味がありそう

## 05の方針
- 逆張り回転する確率を一律にする
- 通常回転の確率(probとおく)の方を決める
- prob=1なら全て通常回転
- prob=0なら全て逆張り回転
- まずは1/4

## 05提出 (prob=1/4)
- 提出前の相対スコア: 46,121,293,949
- 提出前順位: 123位
- 絶対スコア: 59809259
- 相対スコア: 46,340,800,463
- 順位: 106位

## 05を踏まえて(1回目)
- 絶対スコアの上昇(数値は減少)は僅かだが、順位は大きく上がった
- 最適なprobを探す
- 1/4なら逆張り回転のほうが多いのでは
  - 普通に間違えていた
  - それでもこのスコアなのは期待できる
  - 縦長メインで横長が逆張りとも取れるため、そうでもないかも
- 1/2(完全ランダム)で一旦提出する

## 05提出 (prob=1/2)
- 提出前の相対スコア: 46,342,048,493
- 提出前順位: 109位
- 絶対スコア: 60113416
- 相対スコア: 46,156,766,082
- 順位: 123位

## 05を踏まえて(2回目)
- 普通に下がった
- 3/4で試す
  - 1回目で本来やりたかったこと
- そもそも、縦長を積んだほうが良いのではないか
- 3/4で試す
- 縦長を積む方向で考える

## 05提出 (prob=3/4)
- 提出前の相対スコア: 45,901,344,775 
- 提出前順位: 141位
- 絶対スコア: 60336178
- 相対スコア: 45,694,522,995
- 順位: 151位

## 05を踏まえて(3回目)
- 1/4, 1/2よりも下がっている
- やはり縦向きで積んだほうが良いのか

## 06の方針
- 基本的に05と同じ
- 縦長の方を通常回転とする
- 一列の個数を変える
- max(4, √N-3)とmin(N/4, √N+5)の間を繰り返す
- まずはprob=1/4で試す

## 06提出 (prob=1/4)
- 提出前の相対スコア: 45,775,349,316
- 提出前順位: 150位
- 絶対スコア: 59737552
- 相対スコア: 46,221,265,576
- 順位: 117位

## 06を踏まえて(1回目)
- 05のprob=1/4よりも僅かに上がった
- 最適なprobを探す
- 次は1/8と3/8
  - 一旦、中止
  - 07中止に付き再開

## 07の方針
- 左に積んでいく方法も併用
- 意味ないかも
  - 中断

## 06提出 (prob=1/8)
- 提出前の相対スコア: 46,217,660,208
- 提出前順位: 117位
- 絶対スコア: 59642416
- 相対スコア: 46,268,305,084 
- 順位: 115位

## 06を踏まえて(2回目)
- 少しだけ上がった
- 誤差な気もする
- 3/8も試す

## 06提出 (prob=3/8)
- 提出前の相対スコア: 46,268,305,084
- 提出前順位: 116位
- 絶対スコア: 60143274
- 相対スコア: 45,897,192,454 
- 順位: 147位

## 06を踏まえて(3回目)
- 1/8, 1/4よりも低い
- 次は1/16と3/16を試す
  - 誤差も考えると、これで最後

## 06提出 (prob=1/16)
- 提出前の相対スコア: 45,862,005,608
- 提出前順位: 149位
- 絶対スコア: 59501672
- 相対スコア: 46,328,049,288
- 順位: 114位

## 06を踏まえて(4回目)
- 1/8よりも僅かに高い

## 06提出 (prob=3/16)
- 提出前の相対スコア: 46,320,764,665
- 提出前順位: 115位
- 絶対スコア: 59794101
- 相対スコア: 46,102,737,741
- 順位: 133位

## 06を踏まえて(5回目)
- 予想通り、スコアは落ちた
- 1/32も試したくなった
- 3/32はやらない予定
- 1/32のほうが良かった場合、シグモイド関数の復活もありかも

## 06提出 (prob=1/32)
- 提出前の相対スコア: 46,102,737,741
- 提出前順位: 134位
- 絶対スコア: 59684686
- 相対スコア: 46,172,975,115 
- 順位: 126位

## 06を踏まえて(6回目)
- 1/16より低かった
- それはそうとシグモイド関数は試す

## 08の方針
- 04のようにシグモイド関数を用いた回転のみを行う
  - 一定確率との併用はまた今度
  - やっぱり併用する
- まずはa=1/2s, prob=1/16

## 08提出 (a=1/2s, prob=1/16)
- 提出前の相対スコア: 46,282,701,696
- 提出前順位: 135位
- 絶対スコア: 61143296
- 相対スコア: 45,057,261,220
- 順位: 203位

## 08を踏まえて(1回目)
- 01より悪かった
- 定数を変えて色々試す
- それでも駄目ならシグモイド関数は諦める
- 次はa=1/s, prob=1/16で試す

## 08提出 (a=1/s, prob=1/16)
- 提出前の相対スコア: 45,057,261,220
- 提出前順位: 204位
- 絶対スコア: 61143296
- 相対スコア: 45,057,261,220
- 順位: 203位

## 08を踏まえて(2回目)
- 全く変わらない
- コードをよく見たら、シグモイド関数が機能していないことがわかった。
- 修正し、a=1/sでもう一度提出する

## 08提出(修正済み) (a=1/s, prob=1/16)
- 提出前の相対スコア: 45,065,469,299 
- 提出前順位: 211位
- 絶対スコア: 59438526
- 相対スコア: 46,357,832,885
- 順位: 141位

## 08を踏まえて(3回目)
- 最も良いスコアが得られた。
- 最適なaとprobを探したい。
- 次はa=1/2s

## 08提出(修正済み) (a=1/2s, prob=1/16)
- 提出前の相対スコア: 46,348,787,057
- 提出前順位: 145位
- 絶対スコア: 59494038
- 相対スコア: 46,307,589,722
- 順位: 146位

## 08を踏まえて(4回目)
- 僅かに減った
- 次はa=1/0.5sで試す
  - その後でprobもいじりたい

## 08提出(修正済み) (a=1/0.5s, prob=1/16)
- 提出前の相対スコア: 46,279,131,475
- 提出前順位: 150位
- 絶対スコア: 59438526
- 相対スコア: 46,319,318,082
- 順位: 148位

## 08を踏まえて (5回目)
- 3回目と全く変わらない
- ただの偶然なのか、ミスがあるのか
- おそらく偶然だと思う
- a=1/s, prob=1/8で試す

## 08提出(修正済み) (a=1/s, prob=1/8)
- 提出前の相対スコア: 46,215,238,116
- 提出前順位: 191位
- 絶対スコア: 59507996
- 相対スコア: 46,168,805,336
- 順位: 195位

## 08を踏まえて (6回目)
- わずかにスコアが落ちた
- 誤差といえば誤差かも

## 配置のシミュレーションについて
- こちらでコストを計算する術がない
- 自分でつくるか、ChatGPTなどに頼るか
- 計算プログラムを作れば、ビームサーチやchokudaiサーチができる
### とうやって作るか
- x方向に伸びる辺の場合、辺のy座標と始点・終点のx座標を記録
  - y方向の場合は座標軸が逆になる
- 動かす方向がLの場合(x軸方向の移動)、辺のx座標が大きい順に見て、動かす長方形の辺のy座標とかぶっていれば、その座標で停止
  - かぶっているかの判断は、長方形のいずれかの端の座標xが解区間(l,r)に入っているか
- その位置に長方形のx座標を足したy座標と始点・終点のx座標を記録

## 分岐について
- 今までの方針をaとし、新たにbを派生させる

## b01の方針
- 上記の配置シミュレーションを実装する
- その結果に基づき、chokudaiサーチを実装する
  - まずは貪欲法
- 長方形の辺の長さについて
  - 以下のいずれか
  - もう一度normal(u,s)を行う
  - normal(0,s)の絶対値を足す
  - 後者を採用
### 具体的な設計
- box_listに長方形の配置を格納する
- 3次元配列
- [y方向(U移動), x方向(L移動)]の2つ
- [辺0, 辺1, 辺2, …] (対向する座標でソート)
- [y座標, x座標1、x座標2] (U移動の場合)
- 毎回box_listを複製し、最適な操作を追加する
  - 1個の長方形に対する操作は最大99(箱の数)*2(回転の有無)*2(U,L)=396通りであるため、総当りで問題ない
### サンプルケース実行
- ひどい結果
- 一応、貪欲法として機能してはいる？
- どうにかするべき

## b02の方針
- 評価関数にスコアではなくoccupancyを使う
- 正規分布のノイズをtごとに固定する
### サンプルケース実行
- 依然として悪いまま
- なにか間違えているのか？
- chokudaiサーチを実装したら良くなるだろうか

## a09の方針
- 横に並べる方式は維持
- 一層ごとに回転の有無を総当り
  - ビット全探索
- 最もコストが低かったものを採用
  - 評価方法は変更も視野に入れる
### サンプルケース実行
- 時間がかかりすぎている
- 生成AIを用いて他の言語に書き換える
  - うまく行かない
- そもそもスコアがそこまで良くない
- bの路線に戻る

## b03の方針
- chokudaiサーチを実装する
- ビームをt本打つ
- 毎回出力する
- 時間が2900msを超えたら、残りはすべて0を出力する。
### テストケース実行
- いくら待っても終わらない
- breakを書き忘れ、全探索になっていた。
- 修正した
- 良くない結果

## b04の方針
- 評価基準をoccupancyにする
  - 長方形の面積の累積和のリストを作ることで効率化
### テストケース実行
- やはり、悪い結果
- 入力よりsだけ大きくする
  - 全く改善しない
- なぜ縦に積まれるのか

## b05の方針
- 箱の長辺の長さを評価基準にする
  - 同率の場合はcost
## テストケース実行
- また縦に積まれる
- a路線に山登りや焼きなましを組み合わせるべきか

## a10の方針
- a08から引き継ぎ
- 山登り法
- ランダムで逆張り回転を行い、改善したら採用
- あとで山登り法も試したい
- 一旦シグモイドなし

## a10提出 (aなし, prob=1/32)
- 提出前の相対スコア: 45,540,854,194
- 提出前順位: 365位
- 絶対スコア: 59591773
- 相対スコア: 45,426,791,840
- 順位: 373位

## a01を踏まえて (1回目)
- スコアは若干下がったが、まあ悪くはない
- probを変えていくつか試す
- 次は1/16

## a10提出 (aなし, prob=1/16)
- 提出前の相対スコア: 45,426,791,840
- 提出前順位: 373位
- 絶対スコア: 59196924
- 相対スコア: 45,728,718,831
- 順位: 349位

## a10を踏まえて (2回目)
- なかなか良い結果
- 次は1/8
- 焼きなまし法も実装したい
- probの値を少しずつ下げる

## a10提出 (aなし, prob=1/8)
- 提出前の相対スコア: 45,728,718,831
- 提出前順位: 349位
- 絶対スコア: 59230859
- 相対スコア: 45,696,361,462
- 順位: 355位

# a10を踏まえて(3回目)
- 若干スコアが落ちた

# a11の方針
- probを可変にする
- 1/4か1/8くらいから始めて、最終的には1/32まで下げる
- どのように変えていくか
- start_probとend_probを通る一次関数
- まずはstart=1/4, end=1/32

## a11提出 (start=1/4, end=1/32)
- 提出前の相対スコア: 45,686,368,020
- 提出前順位: 355位
- 絶対スコア: 59222844
- 相対スコア: 45,732,143,435
- 順位: 349位

## a11を踏まえて (1回目)
- 悪くはないが、思っていたほどではない
- 1/8から1/16で再提出

## a11提出 (start=1/8, end=1/16)
- 提出前の相対スコア: 45,759,579,663
- 提出前順位: 356位
- 絶対スコア: 59201438
- 相対スコア: 45,755,802,719
- 順位: 356位

## a11を踏まえて (2回目)
- そこまで悪くはないが、良くもない
- 1/8から1/32で再提出

## a11提出 (start=1/8, end=1/32)
- 提出前の相対スコア: 45,708,738,373
- 提出前順位: 356位
- 絶対スコア: 59161027
- 相対スコア: 45,727,315,129
- 順位: 355位

## a11を踏まえて (3回目)
- 過去最高ではある
- 次は1/8から1/nで試す

## a11提出 (start=1/8, end=1/n)
- 提出前の相対スコア: 45,717,755,592
- 提出前順位: 358位
- 絶対スコア: 59142820
- 相対スコア: 45,725,006,536
- 順位: 358位

## a11を踏まえて
- わずかに良くなった
- 順位は変わらなかった